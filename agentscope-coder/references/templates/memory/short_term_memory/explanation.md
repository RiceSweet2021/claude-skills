# 短期记忆管理教程

## 核心概念

短期记忆（Short-term Memory）是 AgentScope 中用于保存对话历史的功能模块。`InMemoryMemory` 是最基础的内存记忆实现，具有以下特点：

1. **自动保存**：每次对话自动保存到记忆中
2. **上下文感知**：Agent 可以引用之前的对话内容
3. **易失性**：程序重启后记忆清空（区别于长期记忆）
4. **容量可控**：可以限制保存的消息条数

短期记忆适合单次会话中的多轮对话场景。

---

## 代码解析

### 知识点 1：创建带记忆的 Agent

**核心代码：**
```python
from agentscope.memory import InMemoryMemory

memory = InMemoryMemory()

agent = ChatAgent(
    name="assistant",
    model_config_name="qwen-max",
    memory=memory
)
```

**解析：**

将 `memory` 参数传递给 Agent 后：

1. **自动存储**：每次对话后，用户输入和 Agent 回复都会自动保存
2. **自动注入**：下次对话时，历史记忆会自动作为上下文传入
3. **无需手动管理**：开发者不需要手动调用保存/读取方法

### 知识点 2：记忆的数据结构

**核心代码：**
```python
# 查看记忆内容
for msg in memory.get_memory():
    print(f"[{msg.role}] {msg.content}")
```

**解析：**

记忆中的每条消息包含以下信息：

| 字段 | 说明 |
|------|------|
| `role` | 角色（user/assistant/system） |
| `content` | 消息内容 |
| `timestamp` | 时间戳（可选） |

记忆按时间顺序排列，最新的在末尾。

### 知识点 3：记忆管理操作

**核心代码：**
```python
# 查看记忆数量
count = len(memory)

# 清空记忆
memory.clear()

# 获取记忆列表
messages = memory.get_memory()
```

**解析：**

常用的记忆管理操作：

| 操作 | 方法 | 说明 |
|------|------|------|
| 查看数量 | `len(memory)` | 返回保存的消息条数 |
| 获取内容 | `memory.get_memory()` | 返回所有消息的列表 |
| 清空记忆 | `memory.clear()` | 删除所有保存的消息 |

---

## 关键知识点总结

| 知识点 | 要点 |
|--------|------|
| InMemoryMemory | 基础的内存记忆实现，数据易失 |
| 自动管理 | 对话自动保存，无需手动操作 |
| 上下文感知 | Agent 可以引用历史对话内容 |
| 记忆操作 | 支持查看、清空等基本操作 |

---

## 长期记忆 vs 短期记忆

| 特性 | 短期记忆 (InMemoryMemory) | 长期记忆 (Mem0/Reme) |
|------|--------------------------|---------------------|
| 持久化 | ❌ 程序重启后清空 | ✅ 持久化到数据库 |
| 适用场景 | 单次会话 | 跨会话用户信息 |
| 实现复杂度 | 简单 | 需要额外配置 |
| 检索能力 | 按顺序获取 | 支持语义检索 |

---

## 练习题

1. 创建一个限制记忆条数为 10 条的 Agent
2. 实现一个"选择性记忆"功能，只保存特定类型的信息
3. 对比有记忆和无记忆 Agent 在多轮对话中的表现差异
