# RAG 检索增强教程

## 核心概念

RAG（Retrieval-Augmented Generation，检索增强生成）是一种结合信息检索和文本生成的技术。它的核心思想是：

1. **知识库**：预先存储结构化或非结构化的文档
2. **检索**：根据用户查询找到相关的文档片段
3. **增强**：将检索到的文档作为上下文提供给 LLM
4. **生成**：LLM 基于检索到的信息生成准确回答

RAG 解决了大模型知识的时效性问题，让 AI 可以回答基于特定文档的问题。

---

## 代码解析

### 知识点 1：构建知识库

**核心代码：**
```python
knowledge_base = [
    "AgentScope 是一个多智能体框架",
    "ReActAgent 支持工具调用功能",
    "ChatAgent 是最基础的对话 Agent"
]

rag = SimpleRAG(knowledge_base)
```

**解析：**

知识库的构建方式：

| 方式 | 说明 | 适用场景 |
|------|------|---------|
| 文本列表 | 简单的字符串列表 | 小规模知识 |
| 文件加载 | 从 txt/md/pdf 文件读取 | 中等规模知识 |
| 数据库连接 | 连接向量数据库 | 大规模知识 |

### 知识点 2：检索相关文档

**核心代码：**
```python
# 根据查询检索相关文档
query = "ReActAgent 有什么功能？"
retrieved_docs = rag.retrieve(query, top_k=3)

# 返回最相关的 3 个文档
for doc in retrieved_docs:
    print(doc)
```

**解析：**

检索过程的要点：

1. **向量化**：将文档和查询转换为向量表示
2. **相似度计算**：计算查询向量和文档向量的相似度
3. **Top-K 选择**：返回相似度最高的 K 个文档

### 知识点 3：增强生成

**核心代码：**
```python
# 将检索结果作为上下文
context = "\n".join(retrieved_docs)

# 结合上下文生成回答
response = agent(f"根据以下信息回答：\n{context}\n\n问题：{query}")
```

**解析：**

增强生成的关键：

| 要点 | 说明 |
|------|------|
| 上下文注入 | 将检索文档作为 prompt 的一部分 |
| 指令设计 | 明确告诉 LLM 只基于提供的文档回答 |
| 来源引用 | 回答时注明信息来自哪个文档 |

---

## 关键知识点总结

| 知识点 | 要点 |
|--------|------|
| 知识库 | 存储结构化文档信息 |
| 检索 | 根据查询找到相关文档（向量相似度） |
| 增强 | 将检索文档作为 LLM 上下文 |
| 生成 | LLM 基于检索信息生成回答 |

---

## RAG 的优势

| 优势 | 说明 |
|------|------|
| 知识时效性 | 可以及时更新知识库，无需重新训练模型 |
| 可解释性 | 可以追溯回答的信息来源 |
| 准确性 | 基于具体文档回答，减少幻觉 |
| 成本效益 | 相比微调，更经济高效 |

---

## 练习题

1. 创建一个包含 10 篇文档的 RAG 系统
2. 实现文档的增删改查功能
3. 添加引用标注，显示回答中使用的文档片段
